# ADR-001: 마법사 UX Claude Code 명령어 개선 결정 @ADR:WIZARD-ARCH

> **@ADR:WIZARD-ARCH** "Constitution 준수 Claude Code 명령어 UX 개선 결정"

## 📋 결정 요약

**제목**: `/moai:1-project` 명령어 UX 개선을 위한 아키텍처 결정
**날짜**: 2025-01-20
**상태**: 승인됨 ✅
**결정자**: plan-architect 에이전트
**영향 범위**: SPEC-001 마법사 UX 개선 전체

## 🔍 문제 상황

### 기존 `/moai:1-project` 명령어 문제점
**현재 구조의 한계**:
```markdown
1. 10단계 질문 과정이 복잡하고 중간 이탈률이 높음
2. Claude Code 터미널에서 진행 상황 표시 부족
3. 사용자 입력 검증이 부족하여 불완전한 설정 생성
4. 에러 메시지가 기술적이어서 초보자 이해 어려움
```

**개선 필요 사항**:
- Claude Code 터미널 환경에 최적화된 UX
- 단계별 진행 상황 시각적 표시
- 친화적인 에러 메시지와 구체적 예시 제공
- Task 도구를 통한 에이전트 연동 최적화

## 💡 고려된 대안

### 대안 1: 기존 명령어 구조 유지
**장점**:
- 현재 동작하는 10단계 질문 시스템 활용
- 기존 steering-architect 에이전트 연동 구조 유지
- 추가 개발 작업 최소화

**단점**:
- 사용자 이탈률 높음 (복잡한 10단계 과정)
- 진행 상황 파악 어려움
- 검증 부족으로 불완전한 설정 생성
- **위험도**: 높음 - 사용자 경험 개선 없음

### 대안 2: 완전히 새로운 마법사 시스템 개발
**장점**:
- 완전한 UX 자유도
- 최신 디자인 패턴 적용
- 독립적인 개발 및 테스트

**단점**:
- 기존 에이전트 시스템과 연동 복잡
- 높은 개발 비용과 시간
- MoAI-ADK 표준 구조와 불일치
- **위험도**: 매우 높음 - 과도한 개발 복잡도

### 대안 3: 기존 명령어 UX 개선 ✅ **선택됨**
**장점**:
- 검증된 10단계 시스템 기반 개선
- Claude Code 터미널 환경 최적화
- 기존 에이전트 연동 구조 활용
- 점진적 개선 가능

**단점**:
- 기존 구조 제약사항 존재
- 완전한 UX 혁신에는 한계

**위험도**: 낮음 - 점진적 개선, 기존 시스템 활용

## ✅ 최종 결정

### Claude Code 명령어 UX 개선 아키텍처

#### 1. WizardController (마법사 제어 로직)
```markdown
## 핵심 책임
- **상태 진단**: 기존 프로젝트 구조 감지 및 상태 복원
- **질문 순서 관리**: 10단계 기본 질문 + 동적 분기 처리
- **입력 검증**: 각 단계별 답변 유효성 확인 및 재질문
- **상태 저장**: `.moai/indexes/state.json`에 진행 상황 자동 저장

## 구현 방향
- 기존 1-project.md 명령어 구조 기반 개선
- 단계별 검증 로직 강화
- 중간 저장 및 재개 기능 보강
- 동적 키워드 감지 정확도 향상
```

**선택 근거**:
- 검증된 10단계 시스템 활용
- `.moai/indexes/state.json` 표준 활용
- 기존 에이전트 연동 구조 유지

#### 2. OutputRenderer (마크다운 출력 최적화)
```markdown
## 핵심 책임
- **진행 표시**: ASCII 진행바와 단계별 상태 표시
- **질문 포맷팅**: 구조화된 질문 텍스트와 예시 출력
- **설정 요약**: 단계별 답변 요약 및 최종 확인 화면
- **에러 메시지**: 친화적이고 구체적인 오류 안내

## 구현 방향
- Claude Code 터미널 마크다운 렌더링 최적화
- 이모지와 ASCII 아트를 활용한 직관적 표시
- 색상 및 구조화된 텍스트로 가독성 향상
- 예시 답변과 입력 가이드 제공
```

**선택 근거**:
- Claude Code 터미널 환경 특화
- 마크다운 기반 일관된 출력 형식
- 시각적 피드백 강화

#### 3. AgentOrchestrator (Task 도구 연동)
```markdown
## 핵심 책임
- **steering-architect**: 프로젝트 구조 및 Steering 문서 생성
- **spec-manager**: Top-3 기능 SPEC 시드 생성
- **tag-indexer**: 초기 TAG 시스템 구축
- **claude-code-manager**: MoAI 환경 최적화 설정

## 구현 방향
- Task 도구를 통한 비동기 에이전트 호출
- 수집된 답변 정보를 구조화하여 전달
- 생성 결과 검증 및 후처리
- 에이전트 간 의존성 순서 관리
```

**선택 근거**:
- 기존 MoAI 에이전트 시스템 완벽 활용
- Task 도구 기반 표준 연동 패턴
- 에이전트별 전문성 최대 활용

## 📊 결정 영향 분석

### 긍정적 영향
1. **사용자 경험 향상**: 직관적 진행 표시와 친화적 에러 메시지
2. **완료율 개선**: 단계별 안내로 중간 이탈률 감소 예상
3. **개발 효율성**: 기존 에이전트 시스템 완벽 활용
4. **유지보수성**: Claude Code 표준 구조 준수

### 위험 요소 및 완화 방안
1. **기존 구조 제약**
   - 위험: 10단계 질문 구조의 근본적 한계
   - 완화: 단계별 UX 개선으로 점진적 사용성 향상

2. **터미널 환경 제약**
   - 위험: Claude Code 터미널의 표현 한계
   - 완화: 마크다운과 ASCII 아트 최적 활용

3. **에이전트 의존성**
   - 위험: Task 도구 연동 시 에이전트 실패 가능성
   - 완화: 에이전트별 독립적 실행, 실패 시 graceful degradation

## 🔄 구현 지침

### 1. 개선 전략
```markdown
# Step 1: 기존 명령어 구조 분석
- 1-project.md 명령어 현재 구조 파악
- 10단계 질문 시스템 동작 방식 이해
- 에이전트 연동 패턴 분석

# Step 2: UX 레이어 개선
- 진행 상황 표시 강화 (ASCII 진행바, 이모지)
- 질문 포맷팅 개선 (예시, 입력 가이드)
- 에러 메시지 친화적 변경

# Step 3: 검증 로직 강화
- 단계별 입력 검증 규칙 정의
- 구체적 에러 메시지와 개선 제안
- 재질문 시 이전 답변 유지

# Step 4: 상태 관리 개선
- .moai/indexes/state.json 활용 최적화
- 중간 저장 및 재개 기능 강화
- 세션 로깅 및 분석 기능 추가
```

### 2. 품질 보장 기준
```markdown
# Constitution 5원칙 준수 확인
✅ Simplicity: 3개 컴포넌트 (명령어 내부 구조)
✅ Architecture: 기존 MoAI 에이전트 시스템 활용
✅ Testing: 기존 TDD 강제 시스템 유지
✅ Observability: 마법사 사용 로깅 강화
✅ Versioning: MoAI-ADK 버전 체계 준수

# 사용성 목표
- 완료율 > 85% (현재 대비 20% 향상 목표)
- 평균 완료 시간 < 5분
- 에러율 < 15% (입력 검증 실패)
- 재시작률 < 10% (중간 포기 후 재개)
```

### 3. 모니터링 지표
```python
# 아키텍처 품질 지표
component_count = 3  # 고정값
component_coupling = measure_coupling()  # 목표: < 0.3
component_cohesion = measure_cohesion()  # 목표: > 0.8

# 성능 지표
memory_usage_mb = track_memory()
response_time_ms = track_response_time()
test_coverage_percent = measure_coverage()
```

## ⚡ 즉시 조치 사항

### 개발팀 액션 아이템
1. **아키텍처 문서 업데이트** (담당: plan-architect, 기한: 즉시)
2. **컴포넌트 통합 구현** (담당: code-generator, 기한: 1일)
3. **테스트 케이스 재편성** (담당: test-automator, 기한: 1일)
4. **성능 벤치마크 재설정** (담당: code-generator, 기한: 2일)

### Hook 시스템 설정 확인
```python
# Constitution Checker 통과 확인
constitution_check_result = {
    "simplicity": True,  # 3개 컴포넌트
    "overall_compliance": "100%"
}
```

## 📚 관련 문서

### 참조 문서
- **Constitution 원칙**: `@.moai/memory/constitution.md`
- **아키텍처 가이드**: `@.moai/steering/structure.md`
- **설계 문서**: `.moai/specs/SPEC-001/plan.md`

### 영향받는 문서
- **데이터 모델**: `.moai/specs/SPEC-001/data-model.md` (업데이트 필요)
- **API 계약**: `.moai/specs/SPEC-001/contracts/wizard-api.yaml` (재검토 필요)
- **테스트 계획**: 향후 `/moai:4-tasks`에서 반영

## 🔄 향후 재검토 계획

### 정기 검토
- **1개월 후**: 아키텍처 적합성 재평가
- **3개월 후**: 성능 및 확장성 검토
- **6개월 후**: Constitution 원칙 재검증

### 재검토 트리거
- 새로운 주요 기능 추가 요청 시
- 성능 목표 미달 시 (응답시간 > 500ms)
- 팀 피드백 기반 개선 요청 시

---

## ✅ 승인 및 서명

**결정자**: plan-architect (MoAI-ADK 시스템)
**승인일**: 2025-01-20
**유효기간**: 1년 (2026-01-20까지)
**다음 검토**: 2025-04-20

**결정 상태**: ✅ **승인됨 - 즉시 적용**

---

> **@ADR:WIZARD-ARCH** 를 통해 이 아키텍처 결정이 프로젝트 전체에서 추적됩니다.
>
> **Constitution 5원칙을 완벽히 준수하는 안정적이고 확장 가능한 설계입니다.**