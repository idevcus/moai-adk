# SPEC-002 수락 기준: Python 코드 품질 개선 시스템

## @TEST:ACCEPTANCE-002 Acceptance Criteria

### AC1. 커버리지 측정 및 유지

**Given** 새로운 Python 코드가 작성되었을 때
**When** `make test` 명령을 실행하면
**Then** 전체 커버리지가 85% 이상이어야 하고, 상세 리포트가 생성되어야 함

#### 상세 검증 기준:

- [ ] 라인 커버리지 ≥ 85%
- [ ] 분기 커버리지 ≥ 80%
- [ ] HTML 리포트 파일 생성 (`htmlcov/index.html`)
- [ ] JSON 리포트 파일 생성 (`.coverage.json`)
- [ ] 커버리지 미달 모듈 목록 출력

#### 테스트 시나리오:

```bash
# 시나리오 1: 신규 모듈 추가
echo "def new_function(): pass" > src/new_module.py
make test
# 예상: 커버리지 감소 경고, 테스트 추가 권장

# 시나리오 2: 기존 코드 수정
# 기존 함수에 새로운 조건문 추가
make test
# 예상: 분기 커버리지 확인, 해당 분기 테스트 권장
```

### AC2. TDD 사이클 자동 커밋

#### AC2.1 RED 단계 자동 커밋

**Given** TDD 사이클을 진행할 때
**When** RED 단계에서 실패 테스트를 작성하면
**Then** "RED: [테스트명] - 실패 테스트 작성" 형식의 자동 커밋이 생성되어야 함

#### 검증 기준:

- [ ] 실패 테스트 감지 자동화
- [ ] 커밋 메시지 템플릿 적용
- [ ] git log에서 RED 커밋 확인 가능

#### AC2.2 GREEN 단계 자동 커밋

**Given** GREEN 단계에서 테스트가 통과되면
**When** 최소 구현이 완료되면
**Then** "GREEN: [테스트명] - 최소 구현 완료" 형식의 자동 커밋이 생성되어야 함

#### 검증 기준:

- [ ] 테스트 통과 감지 자동화
- [ ] 최소 구현 완료 시점 식별
- [ ] 적절한 커밋 메시지 생성

#### AC2.3 REFACTOR 단계 자동 커밋

**Given** REFACTOR 단계를 진행할 때
**When** 리팩토링이 완료되면
**Then** "REFACTOR: [영역] - 코드 품질 개선" 형식의 자동 커밋이 생성되어야 함

#### 검증 기준:

- [ ] 리팩토링 완료 감지 (테스트 유지, 코드 변경)
- [ ] 영향 범위 자동 식별
- [ ] 품질 개선 내용 요약

#### TDD 통합 테스트 시나리오:

```bash
# 완전한 TDD 사이클 테스트
echo "def test_new_feature(): assert False" > tests/test_new.py
# 예상: RED 커밋 자동 생성

echo "def new_feature(): return True" > src/new.py
# 예상: GREEN 커밋 자동 생성

# 코드 리팩토링 수행
echo "def new_feature(): return bool(True)" > src/new.py
# 예상: REFACTOR 커밋 자동 생성
```

### AC3. 개발 가이드 위반 감지

#### AC3.1 함수 크기 검증

**Given** 함수가 50 LOC를 초과하여 작성될 때
**When** 코드 저장 시점에
**Then** 개발 가이드 위반 경고가 표시되고 리팩토링 제안이 제공되어야 함

#### 검증 기준:

- [ ] 실시간 LOC 카운팅
- [ ] 50 LOC 초과 감지
- [ ] 구체적 리팩토링 제안 (함수 분할 방법)
- [ ] 경고 메시지의 명확성

#### AC3.2 파일 크기 검증

**Given** 파일이 300 LOC를 초과할 때
**When** 파일 저장 시점에
**Then** 파일 분할 제안과 함께 위반 경고가 표시되어야 함

#### 검증 기준:

- [ ] 파일 LOC 자동 측정
- [ ] 300 LOC 초과 경고
- [ ] 모듈 분할 제안
- [ ] 책임 분리 가이드 제공

#### AC3.3 매개변수 개수 검증

**Given** 함수 매개변수가 5개를 초과할 때
**When** 코드 분석 시점에
**Then** 매개변수 통합 제안이 제공되어야 함

#### 검증 기준:

- [ ] 함수 시그니처 분석
- [ ] 매개변수 개수 검증 (≤5)
- [ ] 객체화/딕셔너리 활용 제안
- [ ] 가독성 개선 방안 제시

### AC4. 품질 게이트 자동화

#### AC4.1 Pre-commit 훅 실행

**Given** 코드 변경이 발생했을 때
**When** pre-commit 훅이 실행되면
**Then** black, isort, mypy, flake8가 순차적으로 실행되고 모두 통과해야 함

#### 검증 기준:

- [ ] 훅 설치 자동화
- [ ] 4가지 도구 순차 실행
- [ ] 각 도구별 통과/실패 상태 표시
- [ ] 전체 실행 시간 ≤ 30초

#### AC4.2 품질 검사 실패 처리

**Given** 품질 검사 중 하나라도 실패할 때
**When** 커밋을 시도하면
**Then** 커밋이 차단되고 구체적인 수정 방법이 제시되어야 함

#### 검증 기준:

- [ ] 커밋 차단 메커니즘
- [ ] 실패 원인 명확한 표시
- [ ] 수정 명령어 제공
- [ ] 재시도 가이드 제공

## 품질 게이트 통과 기준

### 필수 통과 조건

1. **커버리지**: ≥85% (라인), ≥80% (분기)
2. **코드 품질**: black, isort, mypy, flake8 모두 통과
3. **개발 가이드**: 함수 ≤50 LOC, 파일 ≤300 LOC, 매개변수 ≤5개
4. **TDD 사이클**: RED → GREEN → REFACTOR 순서 준수

### 검증 방법 및 도구

#### 자동화된 검증

- **커버리지**: `pytest --cov` + `coverage report`
- **품질 검사**: `pre-commit run --all-files`
- **개발 가이드**: 커스텀 린터 스크립트
- **TDD 추적**: Git 커밋 히스토리 분석

#### 수동 검증 체크리스트

- [ ] 새로운 기능에 대한 테스트 존재
- [ ] 에지 케이스 테스트 포함
- [ ] 에러 처리 테스트 포함
- [ ] 문서 업데이트 (필요 시)

## 완료 조건 (Definition of Done)

### 기능 완료 기준

- [ ] 모든 AC 시나리오 통과
- [ ] 자동화 스크립트 정상 동작
- [ ] Claude Code 훅 연동 완료
- [ ] 크로스 플랫폼 동작 검증

### 문서화 완료 기준

- [ ] 사용자 가이드 작성
- [ ] API 문서 업데이트
- [ ] 트러블슈팅 가이드 작성
- [ ] 설정 변경 방법 문서화

### 배포 준비 기준

- [ ] 기존 코드베이스 호환성 확인
- [ ] 성능 영향도 측정 (≤10% 오버헤드)
- [ ] 롤백 계획 수립
- [ ] 점진적 적용 방안 준비

## 테스트 환경 및 데이터

### 테스트 환경

- **Python 버전**: 3.11, 3.12, 3.13
- **운영체제**: Windows 10/11, macOS 12+, Ubuntu 20.04+
- **IDE**: VS Code (Claude Code 연동)

### 테스트 데이터

- **소규모 프로젝트**: ~1,000 LOC
- **중간 규모 프로젝트**: ~10,000 LOC
- **대규모 프로젝트**: ~50,000 LOC

---

**연결된 SPEC**:

- SPEC-002 명세서: [spec.md](./spec.md)
- 구현 계획: [plan.md](./plan.md)

**관련 TAG**: @TEST:ACCEPTANCE-002, @TASK:QA-002
