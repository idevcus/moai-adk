# @API:GET-MONITOR "실시간 모니터링 및 대시보드 API"
openapi: 3.0.3
info:
  title: TAG Monitoring API
  description: Real-time monitoring and dashboard API for 16-Core TAG system
  version: 1.0.0
  contact:
    name: MoAI-ADK Team
    url: https://github.com/goos/MoAI-ADK

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server

paths:
  /monitor/dashboard:
    get:
      summary: Get real-time dashboard data
      description: Returns comprehensive dashboard data for TAG system monitoring
      operationId: getDashboard
      parameters:
        - name: refresh_interval
          in: query
          description: Data refresh interval in seconds
          schema:
            type: integer
            minimum: 5
            maximum: 300
            default: 30
        - name: time_range
          in: query
          description: Time range for metrics
          schema:
            type: string
            enum: [1h, 6h, 24h, 7d, 30d]
            default: 24h
      responses:
        '200':
          description: Dashboard data retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'

  /monitor/health:
    get:
      summary: Get system health status
      description: Returns overall health status of TAG system
      operationId: getHealth
      responses:
        '200':
          description: Health status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /monitor/metrics:
    get:
      summary: Get system metrics
      description: Returns detailed metrics about TAG system performance
      operationId: getMetrics
      parameters:
        - name: metric_types
          in: query
          description: Types of metrics to include
          schema:
            type: array
            items:
              type: string
              enum: [performance, coverage, quality, trends]
            default: [performance, coverage, quality]
        - name: granularity
          in: query
          description: Metric data granularity
          schema:
            type: string
            enum: [minute, hour, day]
            default: hour
        - name: from
          in: query
          description: Start time for metrics (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          description: End time for metrics (ISO 8601)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsResponse'

  /monitor/alerts:
    get:
      summary: Get active alerts
      description: Returns current active alerts and notifications
      operationId: getAlerts
      parameters:
        - name: severity
          in: query
          description: Filter by alert severity
          schema:
            type: string
            enum: [critical, warning, info]
        - name: status
          in: query
          description: Filter by alert status
          schema:
            type: string
            enum: [active, acknowledged, resolved]
            default: active
        - name: limit
          in: query
          description: Maximum alerts to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Alerts retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertsResponse'

  /monitor/alerts/{alert_id}/acknowledge:
    post:
      summary: Acknowledge alert
      description: Acknowledges an active alert
      operationId: acknowledgeAlert
      parameters:
        - name: alert_id
          in: path
          required: true
          description: Alert identifier
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlertAcknowledgeRequest'
      responses:
        '200':
          description: Alert acknowledged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertAcknowledgeResponse'

  /monitor/performance:
    get:
      summary: Get performance metrics
      description: Returns detailed performance metrics for TAG operations
      operationId: getPerformanceMetrics
      parameters:
        - name: operation_type
          in: query
          description: Filter by operation type
          schema:
            type: string
            enum: [scan, validate, index, search]
        - name: percentiles
          in: query
          description: Percentiles to include in response
          schema:
            type: array
            items:
              type: number
            default: [50, 90, 95, 99]
      responses:
        '200':
          description: Performance metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceResponse'

  /monitor/coverage:
    get:
      summary: Get TAG coverage metrics
      description: Returns TAG coverage and completeness metrics
      operationId: getCoverageMetrics
      parameters:
        - name: scope
          in: query
          description: Coverage scope
          schema:
            type: string
            enum: [project, directory, file_type]
            default: project
        - name: breakdown
          in: query
          description: Include detailed breakdown
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Coverage metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CoverageResponse'

  /monitor/trends:
    get:
      summary: Get trend analysis
      description: Returns trend analysis for TAG system evolution
      operationId: getTrends
      parameters:
        - name: trend_types
          in: query
          description: Types of trends to analyze
          schema:
            type: array
            items:
              type: string
              enum: [growth, quality, activity, adoption]
            default: [growth, quality, activity]
        - name: period
          in: query
          description: Analysis period
          schema:
            type: string
            enum: [week, month, quarter, year]
            default: month
      responses:
        '200':
          description: Trend analysis retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrendsResponse'

  /monitor/events:
    get:
      summary: Get system events
      description: Returns recent system events and activities
      operationId: getEvents
      parameters:
        - name: event_types
          in: query
          description: Filter by event types
          schema:
            type: array
            items:
              type: string
              enum: [tag_created, tag_modified, tag_deleted, validation_failed, index_updated]
        - name: since
          in: query
          description: Events since timestamp (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          description: Maximum events to return
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
      responses:
        '200':
          description: Events retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventsResponse'

components:
  schemas:
    DashboardResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        summary:
          $ref: '#/components/schemas/SystemSummary'
        health:
          $ref: '#/components/schemas/HealthStatus'
        performance:
          $ref: '#/components/schemas/PerformanceSnapshot'
        coverage:
          $ref: '#/components/schemas/CoverageSnapshot'
        recent_activity:
          type: array
          items:
            $ref: '#/components/schemas/ActivityItem'
        alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'

    SystemSummary:
      type: object
      properties:
        total_tags:
          type: integer
        total_files:
          type: integer
        active_projects:
          type: integer
        last_scan:
          type: string
          format: date-time
        index_size_mb:
          type: number
        uptime_hours:
          type: number

    HealthStatus:
      type: object
      properties:
        overall_status:
          type: string
          enum: [healthy, degraded, critical]
        score:
          type: number
          minimum: 0
          maximum: 100
        components:
          type: object
          properties:
            scanner:
              $ref: '#/components/schemas/ComponentHealth'
            validator:
              $ref: '#/components/schemas/ComponentHealth'
            indexer:
              $ref: '#/components/schemas/ComponentHealth'
            git_integration:
              $ref: '#/components/schemas/ComponentHealth'

    ComponentHealth:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, critical, unknown]
        last_check:
          type: string
          format: date-time
        response_time_ms:
          type: number
        error_rate:
          type: number
        details:
          type: string

    PerformanceSnapshot:
      type: object
      properties:
        current_operations:
          type: integer
        average_response_time_ms:
          type: number
        operations_per_minute:
          type: number
        memory_usage_mb:
          type: number
        cpu_usage_percent:
          type: number
        disk_usage_mb:
          type: number

    CoverageSnapshot:
      type: object
      properties:
        overall_coverage:
          type: number
          description: Overall TAG coverage percentage
        by_category:
          type: object
          additionalProperties:
            type: number
        uncovered_files:
          type: integer
        recent_changes:
          type: integer

    ActivityItem:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        event_type:
          type: string
        description:
          type: string
        user:
          type: string
        file_path:
          type: string
        impact:
          type: string
          enum: [low, medium, high]

    Alert:
      type: object
      properties:
        id:
          type: string
          format: uuid
        severity:
          type: string
          enum: [critical, warning, info]
        title:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        source:
          type: string
        status:
          type: string
          enum: [active, acknowledged, resolved]
        affected_components:
          type: array
          items:
            type: string

    HealthResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/HealthStatus'
        checks:
          type: array
          items:
            $ref: '#/components/schemas/HealthCheck'
        recommendations:
          type: array
          items:
            type: string

    HealthCheck:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
          enum: [pass, fail, warn]
        duration_ms:
          type: number
        details:
          type: object
        last_run:
          type: string
          format: date-time

    MetricsResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        time_range:
          type: object
          properties:
            from:
              type: string
              format: date-time
            to:
              type: string
              format: date-time
        performance:
          $ref: '#/components/schemas/PerformanceMetrics'
        coverage:
          $ref: '#/components/schemas/CoverageMetrics'
        quality:
          $ref: '#/components/schemas/QualityMetrics'
        trends:
          $ref: '#/components/schemas/TrendMetrics'

    PerformanceMetrics:
      type: object
      properties:
        response_times:
          $ref: '#/components/schemas/ResponseTimeMetrics'
        throughput:
          $ref: '#/components/schemas/ThroughputMetrics'
        resource_usage:
          $ref: '#/components/schemas/ResourceUsageMetrics'
        error_rates:
          $ref: '#/components/schemas/ErrorRateMetrics'

    ResponseTimeMetrics:
      type: object
      properties:
        average_ms:
          type: number
        percentiles:
          type: object
          additionalProperties:
            type: number
        by_operation:
          type: object
          additionalProperties:
            type: object

    ThroughputMetrics:
      type: object
      properties:
        operations_per_second:
          type: number
        files_processed_per_hour:
          type: number
        tags_indexed_per_minute:
          type: number

    ResourceUsageMetrics:
      type: object
      properties:
        memory:
          type: object
          properties:
            current_mb:
              type: number
            peak_mb:
              type: number
            average_mb:
              type: number
        cpu:
          type: object
          properties:
            current_percent:
              type: number
            average_percent:
              type: number
        disk:
          type: object
          properties:
            total_usage_mb:
              type: number
            index_size_mb:
              type: number

    ErrorRateMetrics:
      type: object
      properties:
        overall_rate:
          type: number
        by_operation:
          type: object
          additionalProperties:
            type: number
        by_error_type:
          type: object
          additionalProperties:
            type: number

    CoverageMetrics:
      type: object
      properties:
        overall_coverage:
          type: number
        file_coverage:
          type: number
        tag_coverage:
          type: number
        category_coverage:
          type: object
          additionalProperties:
            type: number
        trends:
          type: array
          items:
            $ref: '#/components/schemas/CoverageDataPoint'

    CoverageDataPoint:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        coverage_percentage:
          type: number
        total_files:
          type: integer
        covered_files:
          type: integer

    QualityMetrics:
      type: object
      properties:
        validation_pass_rate:
          type: number
        error_rate:
          type: number
        warning_rate:
          type: number
        consistency_score:
          type: number
        common_issues:
          type: array
          items:
            $ref: '#/components/schemas/QualityIssue'

    QualityIssue:
      type: object
      properties:
        issue_type:
          type: string
        count:
          type: integer
        percentage:
          type: number
        trend:
          type: string
          enum: [increasing, decreasing, stable]

    TrendMetrics:
      type: object
      properties:
        growth_rate:
          type: number
        activity_trend:
          type: string
          enum: [increasing, decreasing, stable]
        quality_trend:
          type: string
          enum: [improving, declining, stable]
        adoption_rate:
          type: number

    AlertsResponse:
      type: object
      properties:
        total_alerts:
          type: integer
        active_alerts:
          type: integer
        alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'
        summary:
          type: object
          properties:
            by_severity:
              type: object
              additionalProperties:
                type: integer
            by_source:
              type: object
              additionalProperties:
                type: integer

    AlertAcknowledgeRequest:
      type: object
      properties:
        user:
          type: string
        comment:
          type: string
        suppress_similar:
          type: boolean
          default: false

    AlertAcknowledgeResponse:
      type: object
      properties:
        alert_id:
          type: string
          format: uuid
        acknowledged_at:
          type: string
          format: date-time
        acknowledged_by:
          type: string
        status:
          type: string

    PerformanceResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        metrics:
          $ref: '#/components/schemas/PerformanceMetrics'
        benchmarks:
          type: object
          properties:
            scan_1000_files_ms:
              type: number
            validate_100_tags_ms:
              type: number
            index_update_ms:
              type: number
        comparisons:
          type: object
          properties:
            vs_baseline:
              type: object
            vs_previous_week:
              type: object

    CoverageResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        coverage:
          $ref: '#/components/schemas/CoverageMetrics'
        gaps:
          type: array
          items:
            $ref: '#/components/schemas/CoverageGap'
        recommendations:
          type: array
          items:
            type: string

    CoverageGap:
      type: object
      properties:
        file_path:
          type: string
        missing_categories:
          type: array
          items:
            type: string
        priority:
          type: string
          enum: [high, medium, low]
        suggested_tags:
          type: array
          items:
            type: string

    TrendsResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        analysis_period:
          type: string
        trends:
          type: object
          properties:
            growth:
              $ref: '#/components/schemas/GrowthTrend'
            quality:
              $ref: '#/components/schemas/QualityTrend'
            activity:
              $ref: '#/components/schemas/ActivityTrend'
            adoption:
              $ref: '#/components/schemas/AdoptionTrend'
        forecasts:
          type: object
          properties:
            next_month_tags:
              type: integer
            expected_coverage:
              type: number

    GrowthTrend:
      type: object
      properties:
        tag_growth_rate:
          type: number
        file_growth_rate:
          type: number
        category_distribution:
          type: object
          additionalProperties:
            type: number
        growth_acceleration:
          type: number

    QualityTrend:
      type: object
      properties:
        error_rate_trend:
          type: string
          enum: [improving, declining, stable]
        consistency_trend:
          type: string
          enum: [improving, declining, stable]
        validation_success_rate:
          type: number
        quality_score_change:
          type: number

    ActivityTrend:
      type: object
      properties:
        commits_with_tags:
          type: number
        active_contributors:
          type: integer
        peak_activity_hours:
          type: array
          items:
            type: integer
        busiest_files:
          type: array
          items:
            type: string

    AdoptionTrend:
      type: object
      properties:
        new_files_with_tags:
          type: number
        tag_density_increase:
          type: number
        category_adoption:
          type: object
          additionalProperties:
            type: number

    EventsResponse:
      type: object
      properties:
        total_events:
          type: integer
        events:
          type: array
          items:
            $ref: '#/components/schemas/SystemEvent'
        summary:
          type: object
          properties:
            by_type:
              type: object
              additionalProperties:
                type: integer
            by_hour:
              type: object
              additionalProperties:
                type: integer

    SystemEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        timestamp:
          type: string
          format: date-time
        event_type:
          type: string
        source:
          type: string
        user:
          type: string
        details:
          type: object
        impact:
          type: string
          enum: [low, medium, high]
        related_files:
          type: array
          items:
            type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
            timestamp:
              type: string
              format: date-time

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - ApiKeyAuth: []

tags:
  - name: monitoring
    description: Real-time system monitoring
  - name: metrics
    description: Performance and quality metrics
  - name: alerts
    description: Alert management and notifications
  - name: trends
    description: Trend analysis and forecasting