---
description: EARS 형식 명세 작성 - 비즈니스 요구사항을 구조화된 명세로 변환
argument-hint: <feature-description>|<SPEC-ID>|--project [additional-details...]
allowed-tools: Read, Write, Edit, MultiEdit, Bash, Task
---

# MoAI-ADK  SPEC 작성 (GitFlow 통합)

!@ spec-builder 에이전트를 활용해 비즈니스 요구사항을 EARS 형식의 엔지니어링 명세로 변환하고 GitFlow 워크플로우를 자동 통합합니다.

## 🔀 GitFlow 자동화 실행 코드 (완전 투명)

```bash
# 1. feature 브랜치 자동 생성
git checkout main || git checkout develop
git pull origin $(git branch --show-current)
SPEC_ID="SPEC-$(printf "%03d" $(ls .moai/specs/ 2>/dev/null | wc -l | xargs expr 1 +))"
BRANCH_NAME="feature/${SPEC_ID}-$(echo "${FEATURE_NAME}" | tr '[:upper:]' '[:lower:]' | tr ' ' '-')"
git checkout -b "${BRANCH_NAME}"
git push --set-upstream origin "${BRANCH_NAME}"

# 2. 통합 SPEC 파일 생성 및 커밋
git add .moai/specs/${SPEC_ID}/spec.md
git commit -m "📝 ${SPEC_ID}: ${FEATURE_NAME} 통합 명세 작성 완료

- EARS 형식 요구사항 정의
- 사용자 스토리 및 수락 기준 포함
- 우선순위 매트릭스 및 성공 지표 정의
- 16-Core @TAG 체인 설정
- Constitution 5원칙 검증"

git add .
git commit -m "🎯 ${SPEC_ID}: 프로젝트 구조 생성 및 Draft PR 준비"

# 3. Draft PR 자동 생성 (gh CLI)
gh pr create --draft --title "[${SPEC_ID}] ${FEATURE_NAME}" --body "$(cat <<EOF
## 📋 EARS Specification Summary
- **Environment**: ${ENVIRONMENT}
- **Assumptions**: ${ASSUMPTIONS}
- **Requirements**: ${REQUIREMENTS}
- **Specifications**: ${SPECIFICATIONS}

### 🔗 16-Core @TAG Chain
- @REQ:${REQ_TAGS}
- @DESIGN:${DESIGN_TAGS}
- @TASK:${TASK_TAGS}
- @TEST:${TEST_TAGS}

### ✅ Next Steps
- [ ] Implementation (/moai:2-build)
- [ ] Testing (TDD Red-Green-Refactor)
- [ ] Documentation (/moai:3-sync)

🗿 Generated by MoAI-ADK spec-builder
EOF
)"
```

비즈니스 요구사항을 EARS(Easy Approach to Requirements Syntax) 형식의 엔지니어링 명세로 변환합니다. **GitFlow가 완전히 통합**되어 버전 관리가 자동으로 처리됩니다.

## 📝 SPEC 템플릿

spec-builder 에이전트가 다음 표준 템플릿을 사용하여 통합된 spec.md 파일을 생성합니다:

```markdown
# 기능 명세서: [SPEC_NAME]

**SPEC-ID**: SPEC-XXX
**상태**: 초안
**우선순위**: P0/P1/P2
**작성일**: YYYY-MM-DD
**작성자**: MoAI-ADK spec-builder

## 개요

[기능에 대한 상세 설명]

## 사용자 스토리

### US-001: 핵심 기능

**사용자로서** [사용자 역할]
**나는 원한다** [원하는 기능]을
**그래서** [달성하고자 하는 목표]

**수락 기준**:
- [구체적 조건 1]
- [구체적 조건 2]
- [구체적 조건 3]

### US-002: 부가 기능

**사용자로서** [사용자 역할]
**나는 원한다** [원하는 기능]을
**그래서** [달성하고자 하는 목표]

**수락 기준**:
- [구체적 조건 1]
- [구체적 조건 2]
- [구체적 조건 3]

## 인수 조건 (EARS 형식)

### 기능적 요구사항

- **FR-001**: **언제** [트리거 조건]이면
  **그러면** 시스템은 [예상 동작]해야 한다

- **FR-002**: **만약** [조건]이고 **언제** [트리거]이면
  **그러면** 시스템은 [동작]해야 한다

- **FR-003**: **어디서** [위치/컨텍스트]에서 **언제** [트리거]이면
  **그러면** 시스템은 [동작]해야 한다

### 비기능적 요구사항

- **NFR-001**: **언제** [조건]일 때
  **그러면** 시스템은 [성능 기준]을 만족해야 한다

- **NFR-002**: **어디서** [환경]에서
  **그러면** 시스템은 [보안/안정성 기준]을 유지해야 한다

### 제약사항

- **CON-001**: 시스템은 [기술적 제약사항]을 준수해야 한다
- **CON-002**: [비즈니스 제약사항]으로 인해 [특정 동작]은 제한된다

## 우선순위 매트릭스

| 기능 | 비즈니스 가치 | 구현 복잡도 | 우선순위 |
|------|---------------|-------------|----------|
| [핵심기능1] | High | Medium | P1 |
| [핵심기능2] | High | High | P2 |
| [부가기능1] | Medium | Low | P3 |

## 성공 지표

### 정량적 지표
- [측정 가능한 목표 1]
- [측정 가능한 목표 2]
- [측정 가능한 목표 3]

### 정성적 지표
- [사용자 경험 목표 1]
- [사용자 경험 목표 2]

## 리스크 및 의존성

### 주요 리스크
- **R-001**: [리스크 설명] - 영향도: [High/Medium/Low]
- **R-002**: [리스크 설명] - 영향도: [High/Medium/Low]

### 외부 의존성
- [의존성 1]: [설명 및 영향]
- [의존성 2]: [설명 및 영향]

## 검토 및 승인

### 검토자
- [ ] Product Owner: [승인/조건부승인/반려]
- [ ] Tech Lead: [승인/조건부승인/반려]
- [ ] QA Lead: [승인/조건부승인/반려]

### 다음 단계
**명세 완료 후**: /moai:2-build

---

**@REQ:CORE** - SPEC-XXX 핵심 요구사항
**@DESIGN:ARCH** - 아키텍처 설계 필요
**@TEST:ACC** - 인수 테스트 시나리오 정의 필요

**MoAI-ADK GitFlow 워크플로우**:
1. `/moai:1-spec` - 이 명세 작성 (spec-builder 에이전트)
2. `/moai:2-build` - TDD 구현 (code-builder 에이전트)
3. `/moai:3-sync` - 문서 동기화 및 PR Ready (doc-syncer 에이전트)

**작성 규칙**:
- EARS 형식 요구사항
- Constitution 5원칙 준수
- 16-Core @TAG 시스템 활용
```

## 🚀 빠른 시작

```bash
# 단일 기능 SPEC 작성
/moai:1-spec "JWT 기반 사용자 인증 시스템"

# 프로젝트 전체 SPEC 대화형 생성
/moai:1-spec --project

# 기존 SPEC 수정
/moai:1-spec SPEC-001 "추가 보안 요구사항"
```

## 🔄 실행 흐름 (GitFlow 자동화)

```mermaid
flowchart TD
    A[/moai:1-spec 입력] --> A1[🔀 feature 브랜치 자동 생성]
    A1 --> B{입력 타입 분석}
    B -->|--project| C[대화형 프로젝트 분석]
    B -->|feature-description| E[단일 SPEC 작성]
    B -->|SPEC-ID| F[기존 SPEC 수정]

    C --> G[5단계 질문/답변]
    E --> I[EARS 형식 변환]
    F --> I

    G --> J[다중 SPEC 생성]
    I --> K[품질 검증]
    J --> K
    K --> K1[📝 SPEC 파일 자동 커밋]
    K1 --> K2[🔄 Draft PR 생성]
    K2 --> L[완료: /moai:2-build로 이동]
```

## 🔀 GitFlow 자동 통합 

### 완전 투명한 버전 관리
사용자는 Git 명령어를 전혀 알 필요 없이 모든 버전 관리가 자동 처리됩니다.

#### 1. Feature 브랜치 자동 생성
```bash
# 자동 실행 (사용자 불가시)
git checkout -b feature/SPEC-001-user-auth
git push -u origin feature/SPEC-001-user-auth
```

#### 2. 단계별 자동 커밋
- **통합 명세**: `📝 SPEC-001: JWT 인증 시스템 통합 명세 작성 완료`
- **프로젝트 구조**: `🎯 SPEC-001: 프로젝트 구조 생성 및 Draft PR 준비`

#### 3. Draft PR 자동 생성
```bash
# gh CLI로 자동 실행
gh pr create --draft \
  --title "SPEC-001: 사용자 인증 시스템" \
  --body "🧭 통합 SPEC 작성 완료

## 📋 생성된 파일
- spec.md (통합 명세 문서)
  - EARS 형식 요구사항 12개
  - 사용자 스토리 5개
  - 수락 기준 15개 시나리오
  - 우선순위 매트릭스
  - 성공 지표 및 리스크 분석

## 🎯 다음 단계
/moai:2-build SPEC-001"
```

### 브랜치 전략
- **feature/SPEC-XXX-{feature-name}**: SPEC 작성용 브랜치
- **develop**: 통합 브랜치 (자동 머지 대상)
- **main**: 릴리스 브랜치 (수동 머지)

## 🤖 spec-builder 에이전트 자동화

**spec-builder 에이전트**가 전체 SPEC 작성 + GitFlow 과정을 완전 자동화:

- **요구사항 분석**: EARS 키워드(WHEN/IF/WHILE/WHERE/UBIQUITOUS) 구조화
- **User Story 생성**: US-XXX 형식의 체계적 사용자 스토리
- **수락 기준 작성**: Given-When-Then 테스트 가능 기준
- **Git 워크플로우**: 브랜치 생성 → 커밋 → PR 생성까지 전자동

## 📋 --project 옵션 (대화형 프로젝트 SPEC) 🔥

### 기능 개요
5단계 질문을 통해 프로젝트 전체를 분석하고 모든 핵심 기능의 SPEC을 자동 생성합니다.

### 질문 단계
중요: 각 
1. **프로젝트 유형**: 웹앱, API, 모바일앱, 데스크톱앱
2. **핵심 기능**: 사용자 관리, 결제, 알림, 콘텐츠 관리 등
3. **사용자 유형**: 일반 사용자, 관리자, 게스트 등
4. **성능 요구사항**: 응답시간, 동시 접속자, 처리량
5. **보안 요구사항**: 인증 방식, 개인정보, 규정 준수

### 생성 결과
```bash
🎯 프로젝트 SPEC 생성 완료:

├── SPEC-001: 사용자 인증 시스템 (P0)
├── SPEC-002: 게시글 관리 시스템 (P0)
├── SPEC-003: 댓글 및 좋아요 (P1)
├── SPEC-004: 관리자 대시보드 (P1)
└── SPEC-005: 모니터링 시스템 (P2)

총 5개 SPEC 생성 (2분 30초)
다음: /moai:2-build SPEC-001
```

## 📝 EARS 형식 변환 자동화

### EARS 키워드 활용
- **WHEN**: 조건 발생 시 → 명확한 트리거 정의
- **IF**: 특정 상태 → 조건부 동작 정의
- **WHILE**: 진행 중 → 지속적 처리 정의
- **WHERE**: 특정 환경 → 컨텍스트별 동작
- **UBIQUITOUS**: 항상 → 전역 규칙 정의

### 변환 예시
**Before**: "사용자가 로그인할 수 있어야 한다"

**After**:
```markdown
WHEN 사용자가 올바른 이메일과 패스워드를 입력하면,
시스템은 3초 이내에 JWT 토큰을 생성하고 대시보드로 리디렉션해야 한다.

IF 잘못된 인증 정보가 3회 연속 입력되면,
시스템은 해당 계정을 15분간 잠그고 관리자에게 알림을 발송해야 한다.
```

## 📋 User Stories & 수락 기준 생성

### US-XXX 형식 템플릿
```markdown
US-001: 사용자 로그인
As a 일반 사용자
I want to 이메일과 패스워드로 로그인
So that 개인화된 서비스를 이용할 수 있다

수락 기준:
- 올바른 이메일 형식 검증
- 패스워드 최소 8자리 이상
- 3회 실패 시 계정 임시 잠금
- 성공 시 대시보드 리다이렉트
```

### Given-When-Then 시나리오
```markdown
**Scenario: 성공적인 로그인**
Given 등록된 사용자 "user@example.com"이 존재하고
When 올바른 이메일과 패스워드를 입력하고 "로그인"을 클릭하면
Then 3초 이내에 JWT 토큰을 생성하고
  And 대시보드로 리디렉션하며
  And "환영합니다, [사용자명]님" 메시지를 표시한다
```

## 📁 생성 파일 구조

```
.moai/specs/SPEC-XXX/
└── spec.md           # 통합 명세 문서
                      # ├─ EARS 형식 요구사항
                      # ├─ 사용자 스토리
                      # ├─ 수락 기준
                      # ├─ 우선순위 매트릭스
                      # ├─ 성공 지표
                      # └─ 리스크 및 의존성
```

## ✅ 품질 검증 자동화

### 검증 기준
- 모든 User Story에 수락 기준 존재 (최소 3개)
- EARS 요구사항의 테스트 가능성 확인
- [NEEDS CLARIFICATION] 마커 10% 이하
- @REQ 태그를 통한 추적성 보장

### 검증 결과
```markdown
📊 SPEC 품질 지표:
- User Stories: 12개 생성
- EARS 요구사항: 35개
- 수락 기준: 36개 시나리오
- 명확성 점수: 94%
- 추적성 매트릭스: 100% 완료
```

## 🔄 완료 후 다음 단계

###  GitFlow 통합 워크플로우
```bash
✅ SPEC 작성 + GitFlow 완료!

🔀 Git 작업 (자동 완료):
├── feature/SPEC-001-user-auth 브랜치 생성
├── 2단계 커밋 완료 (통합 명세 → 프로젝트 구조)
└── Draft PR #123 생성: "SPEC-001: 사용자 인증 시스템"

📁 생성된 파일:
└── .moai/specs/SPEC-001/
    └── spec.md (통합 명세 문서)
        ├─ EARS 요구사항 12개
        ├─ 사용자 스토리 5개
        ├─ 수락 기준 15개 시나리오
        ├─ 우선순위 매트릭스
        ├─ 성공 지표
        └─ 리스크 및 의존성

🎯 다음 단계 (2단계 파이프라인):
> /moai:2-build SPEC-001  # TDD 구현 (자동 PR 업데이트)
> /moai:3-sync           # 문서 동기화 + PR Ready
```

## ⚠️ 에러 처리

### Steering 문서 누락
```bash
❌ Steering 문서가 필요합니다.
먼저: moai init 실행하여 프로젝트 초기화
```

### 불완전한 입력
```bash
⚠️ 더 구체적인 요구사항 필요:
예: /moai:1-spec "JWT 인증 - 소셜 로그인, 토큰 갱신, 권한 관리"
```

### [NEEDS CLARIFICATION] 미해결
```bash
🔴 명세에 불명확한 부분이 있습니다.
모든 명확화 마커 해결 후 /moai:2-build 진행 가능
```

## 🔁 응답 구조

출력은 반드시 3단계 구조를 따릅니다:
1. **Phase 1 Results**: SPEC 생성 결과
2. **Phase 2 Plan**: 다음 단계 계획
3. **Phase 3 Implementation**: 구체적 실행 안내

이 명령어는 MoAI-ADK 0.2.0의 핵심으로, 단순화된 인터페이스로 강력한 SPEC 작성을 제공합니다.
