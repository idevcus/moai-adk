---
description: Living Document 동기화 - 코드↔문서 실시간 동기화와 16-Core TAG 인덱싱
argument-hint: [auto|force|status] [target-path]
allowed-tools: Read, Write, Edit, MultiEdit, Bash, Task
---

# 🔄 MoAI-ADK Living Document 동기화

코드↔문서 실시간 동기화 메커니즘을 통해 완벽한 일치성을 유지하며, 16-Core @TAG 시스템으로 완전한 추적성을 보장하는 핵심 명령어입니다. 모든 변경사항은 자동으로 감지되고 양방향으로 동기화됩니다.

> 참고: 동기화 대상에는 `.moai/memory/common.md` 와 스택별 메모 문서도 포함되므로, 구현 단계에서 갱신한 체크 항목은 이 명령으로 최신화하세요.


## 자연어 체이닝 오케스트레이션

🤖 Living Document 동기화를 시작합니다. 현재 프로젝트 상태를 분석하여 최적의 동기화 전략을 선택하겠습니다.

### 모드 자동 감지

현재 모드 분석: !`echo $1 | grep -E "force|auto" || echo "auto"`

### 자동 모드 (auto - 기본값)

Task tool을 사용하여 tag-indexer와 doc-syncer 에이전트를 동시에 호출하여 증분 동기화를 수행합니다 - tag-indexer는 변경된 @TAG 참조만 감지하고 업데이트하며, doc-syncer는 최소한의 오버헤드로 수정된 문서를 동기화합니다.

### 강제 모드 (force)

Task tool을 사용하여 tag-indexer와 doc-syncer 에이전트를 동시에 호출하여 완전한 재동기화를 수행합니다 - tag-indexer는 전체 @TAG 인덱스를 처음부터 다시 구축하고, doc-syncer는 대상 범위에 대한 완전한 문서 재생성을 수행합니다.

## 동기화 모드별 처리

### Auto 모드 - 증분 동기화 (기본값)

```
🔄 증분 동기화 실행 중...

┌─ 변경 감지 및 분석 ───────────────────────────┐
│                                            │
│ 📊 변경사항 스캔:                           │
│ ├── 수정된 파일: 3개 감지                    │
│ │   ├── src/auth/service.ts (25분 전)      │
│ │   ├── src/api/users.ts (12분 전)         │
│ │   └── src/components/Login.tsx (8분 전)   │
│ │                                          │
│ ├── 새로운 @TAG: 2개 발견                   │
│ │   ├── @FEATURE:password-reset            │
│ │   └── @API:forgot-password               │
│ │                                          │
│ └── 삭제된 파일: 0개                        │
│                                            │
│ ⚡ 최적화된 처리: 전체 스캔 대신 델타만 처리  │
└────────────────────────────────────────────┘

┌─ 병렬 증분 동기화 실행 ──────────────────────┐
│                                            │
│ 🏷️ tag-indexer (좌측)    📚 doc-syncer (우측)│
│ ┌─────────────────────┐  ┌─────────────────┐│
│ │ 변경된 TAG 처리:    │  │ 영향받은 문서:   ││
│ │ ├── @FEATURE: 1개   │  │ ├── API.md 업데이트││
│ │ ├── @API: 1개       │  │ ├── README 섹션 갱신││
│ │ └── 인덱스 증분 갱신 │  │ └── 컴포넌트 문서 갱신││
│ │                    │  │                 ││
│ │ ⏱️ 처리시간: 8초     │  │ ⏱️ 처리시간: 12초 ││
│ │ 💾 메모리: 15MB     │  │ 💾 메모리: 22MB  ││
│ └─────────────────────┘  └─────────────────┘│
│                                            │
│ ✅ 증분 동기화 완료: 효율적 처리 완료         │
└────────────────────────────────────────────┘
```

### Force 모드 - 완전 재동기화

```
🔄 완전 재동기화 실행 중...

⚠️ 경고: 전체 프로젝트 재분석으로 시간이 소요될 수 있습니다.

┌─ 전체 프로젝트 스캔 ─────────────────────────┐
│                                            │
│ 📂 스캔 대상:                               │
│ ├── 소스 파일: 45개 (TypeScript/JSX)        │
│ ├── 테스트 파일: 70개                        │
│ ├── 문서 파일: 15개 (Markdown)               │
│ ├── 설정 파일: 8개                          │
│ └── 총 138개 파일 전체 분석                  │
│                                            │
│ 🔍 심층 분석 모드:                           │
│ ├── AST 파싱: 모든 코드 구조 재분석          │
│ ├── 의존성 그래프: 전체 재구축                │
│ ├── 태그 맵핑: 처음부터 재생성               │
│ └── 문서 템플릿: 최신 버전으로 재생성         │
└────────────────────────────────────────────┘

┌─ 병렬 완전 재동기화 실행 ────────────────────┐
│                                            │
│ 🏷️ tag-indexer (전체 재구축)               │
│ ┌─────────────────────────────────────────┐│
│ │ 전체 TAG 인덱스 재구축:                  ││
│ │ ├── 📊 통계 수집: ████████████ 100%     ││
│ │ ├── 🔗 연결성 분석: ████████████ 100%   ││
│ │ ├── 📝 인덱스 생성: ████████████ 100%   ││
│ │ └── 🔍 무결성 검증: ████████████ 100%   ││
│ │                                        ││
│ │ 📈 최종 결과:                           ││
│ │ ├── 총 태그: 156개 (기존 148개 +8개)    ││
│ │ ├── 연결: 312개 (100% 유효)             ││
│ │ └── 오류: 0개                           ││
│ └─────────────────────────────────────────┘│
│                                            │
│ 📚 doc-syncer (문서 완전 재생성)             │
│ ┌─────────────────────────────────────────┐│
│ │ 모든 문서 재생성:                        ││
│ │ ├── 📖 API 문서: ████████████ 100%      ││
│ │ ├── 📋 컴포넌트 문서: ████████████ 100% ││
│ │ ├── 📄 README: ████████████ 100%       ││
│ │ ├── 📊 아키텍처 문서: ████████████ 100% ││
│ │ └── 🔧 설정 가이드: ████████████ 100%   ││
│ │                                        ││
│ │ 📈 문서 상태:                           ││
│ │ ├── 생성: 15개 (모든 문서 최신화)        ││
│ │ ├── 템플릿: 최신 버전 적용               ││
│ │ └── 일치도: 100% (코드와 완벽 일치)      ││
│ └─────────────────────────────────────────┘│
│                                            │
│ ⏱️ 전체 처리시간: 2분 35초                  │
│ 💾 최대 메모리 사용: 89MB                   │
│                                            │
│ ✅ 완전 재동기화 완료: 완벽한 일치성 보장     │
└────────────────────────────────────────────┘
```

## 대상 경로 지정 ($2)

### 전체 프로젝트 (기본값)

```bash
> /moai:6-sync auto
```

- 모든 소스 파일과 문서 동기화
- 프로젝트 전체 범위 처리

### 특정 디렉토리

```bash
> /moai:6-sync auto src/components
```

- 지정된 디렉토리와 관련 문서만 동기화
- 부분적 동기화로 처리 시간 단축

### 특정 파일

```bash
> /moai:6-sync force src/api/users.ts
```

- 단일 파일과 연관된 문서만 처리
- 정밀한 동기화 제어

### 특정 기능 영역

```bash
> /moai:6-sync auto @FEATURE:authentication
```

- @TAG 기반 범위 지정
- 기능 단위 동기화 처리

## 실시간 동기화 모니터링

### 진행 상황 실시간 표시

```
🔄 실시간 동기화 진행 상황

┌─ 전체 진행률 ────────────────────────────────┐
│ ████████████████████████████████ 85% (85/100)│
│                                            │
│ 현재 작업: API 문서 업데이트 중...            │
│ 예상 완료: 45초 후                           │
└────────────────────────────────────────────┘

📊 세부 진행률:
├── 파일 스캔: ████████████ 100% (완료)
├── TAG 추출: ████████████ 100% (완료)
├── 의존성 분석: ████████████ 100% (완료)
├── 문서 생성: ████████████ 85% (진행중)
└── 검증: ████████ 0% (대기중)

💻 시스템 리소스:
├── CPU: ████████ 23%
├── 메모리: ████████████ 67MB / 200MB
└── 디스크 I/O: ████████ 15MB/s
```

### 에러 처리 및 복구

```
❌ 동기화 중 오류 발생

오류 내용: src/api/webhook.ts 파싱 실패
원인: TypeScript 문법 오류 (Line 45: 예상치 못한 토큰)

🔧 자동 복구 시도:
├── 1단계: 백업에서 이전 버전 복원 ✅
├── 2단계: 문법 오류 자동 수정 시도...
├── 3단계: 수정된 버전으로 재시도...
└── 복구 완료: 동기화 재개

✅ 복구 성공: 모든 파일이 정상적으로 동기화되었습니다.
```

## 동기화 결과 상세 리포트

### 성공적인 Auto 모드 완료

```
✅ 증분 동기화가 완료되었습니다!

📊 동기화 결과:
├── 🕐 처리 시간: 28초
├── 📁 처리된 파일: 8개 (변경된 파일만)
├── 🏷️ 업데이트된 태그: 5개
├── 📝 수정된 문서: 4개
├── 💾 메모리 사용: 31MB (최적화됨)
└── 🚀 처리 속도: 3.2배 향상 (전체 스캔 대비)

🔄 변경사항 세부내역:
├── 새로 추가된 기능:
│   ├── @FEATURE:password-reset → forgot-password.md 생성
│   └── @API:forgot-password → API.md 섹션 추가
│
├── 업데이트된 문서:
│   ├── README.md: 새 기능 섹션 추가
│   ├── components.md: Login 컴포넌트 props 업데이트
│   ├── API.md: 새 엔드포인트 문서화
│   └── architecture.md: 인증 플로우 다이어그램 수정
│
└── 태그 인덱스:
    ├── 신규: 5개, 수정: 3개, 삭제: 0개
    └── 전체 연결성: 100% 유지

🎯 품질 지표:
├── 📊 추적성: 100% (모든 태그 연결됨)
├── 📄 문서 일치도: 100% (코드와 완벽 동기화)
├── ⚡ 성능: 목표 대비 120% 향상
└── 🔒 무결성: 검증 완료, 오류 0개

💡 최적화 효과:
전체 동기화 대비 87% 시간 단축 (2분 35초 → 28초)
```

### 강제 모드 완료

```
🎉 완전 재동기화가 완료되었습니다!

📊 동기화 결과:
├── 🕐 처리 시간: 2분 35초
├── 📁 처리된 파일: 138개 (전체 프로젝트)
├── 🏷️ 재구축된 태그: 156개
├── 📝 재생성된 문서: 15개
├── 💾 메모리 사용: 89MB (최대)
└── 🔄 처리 방식: 완전 재분석

🆕 새로 발견된 항목:
├── 누락된 태그: 8개 발견 및 추가
│   ├── @PERF:cache-optimization (성능 최적화)
│   ├── @SEC:input-validation (보안 검증)
│   └── @TODO:refactor-legacy (리팩토링 필요)
│
├── 개선된 연결성:
│   ├── 이전: 304개 연결 (2개 끊어진 링크)
│   ├── 현재: 312개 연결 (모두 유효)
│   └── 개선: +8개 신규 연결, 100% 무결성
│
└── 최신화된 문서:
    ├── 구식 템플릿: 3개 → 최신 버전으로 업데이트
    ├── 누락된 섹션: 7개 → 자동 생성 완료
    └── 불일치 내용: 12건 → 코드와 완벽 동기화

🏆 품질 개선:
├── 📊 추적성: 98.7% → 100% (+1.3%)
├── 📄 문서 완전성: 91.2% → 100% (+8.8%)
├── 🔗 연결 무결성: 99.3% → 100% (+0.7%)
└── 📝 문서 최신성: 86.5% → 100% (+13.5%)

✨ 주요 개선사항:
1. 모든 API 엔드포인트에 대한 완전한 문서 생성
2. 컴포넌트별 props와 사용 예시 추가
3. 아키텍처 다이어그램 최신 상태 반영
4. 테스트 가이드라인과 실제 테스트 코드 동기화
5. 성능 최적화 내역의 완전한 문서화

🚀 다음 권장사항:
auto 모드가 향후 충분하므로 force 모드는 주요 리팩토링 시에만 사용 권장
```

## 동기화 설정 및 사용자 정의

### 자동 동기화 설정

```bash
# Hook 시스템을 통한 자동 동기화 활성화
> /moai:6-sync config --auto-sync=on

# 특정 파일 패턴만 감시
> /moai:6-sync config --watch-pattern="src/**/*.{ts,tsx,js,jsx}"

# 동기화 주기 설정 (실시간 vs 배치)
> /moai:6-sync config --mode=realtime
```

### 성능 최적화 설정

```bash
# 메모리 사용량 제한
> /moai:6-sync config --memory-limit=100MB

# 병렬 처리 워커 수 조정
> /moai:6-sync config --workers=4

# 캐시 활용 설정
> /moai:6-sync config --cache=aggressive
```

## ⚠️ 에러 처리

### 동기화 실패 시
```markdown
❌ ERROR: 동기화 작업이 실패했습니다.

일반적인 원인:
1. 파일 권한 문제 → sudo 권한으로 재시도
2. 메모리 부족 → 메모리 제한 늘리기
3. 파일 잠금 → 다른 프로세스 종료 후 재시도
4. 네트워크 문제 → 오프라인 모드로 전환

자동 복구 옵션:
> /moai:6-sync recover --backup-restore
> /moai:6-sync recover --force-unlock
> /moai:6-sync recover --memory-cleanup
```

### 프로젝트 구조 미지원
```markdown
⚠️ WARNING: 지원하지 않는 프로젝트 구조입니다.

필수 조건:
- .moai/ 디렉토리 존재
- .claude/ 설정 폴더 존재
- 최소 1개 이상의 소스 파일

해결 방법:
먼저 프로젝트를 초기화해주세요:
> /moai:1-project init
```

### 태그 인덱스 손상
```markdown
🔴 ERROR: TAG 인덱스가 손상되었습니다.

손상 감지:
- tags.json 파일 구문 오류
- 참조 무결성 실패
- 중복 태그 ID 발견

복구 방법:
전체 재인덱싱을 실행합니다:
> /moai:6-sync force --rebuild-index
```

### 성능 최적화 팁

```
🚀 성능 최적화 권장사항:

1. 증분 모드 우선 사용: 87% 시간 단축
2. 특정 경로 지정: 불필요한 스캔 방지
3. 배치 모드 활용: 대량 변경 시 효율적
4. 캐시 활성화: 반복 작업 속도 향상
5. 메모리 모니터링: 대용량 프로젝트 대응
```

이 명령어를 통해 코드와 문서가 항상 완벽하게 동기화된 상태를 유지하며, 프로젝트의 일관성과 추적성을 보장합니다.
## 🔁 응답 구조(필수)
항상 3단계 구조로 응답: 1) Phase 1 Results  2) Phase 2 Plan  3) Phase 3 Implementation.  
동기화는 보안/커밋 규칙을 준수: @.claude/memory/security_rules.md, @.claude/memory/git_commit_rules.md
